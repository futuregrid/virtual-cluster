
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>INTRODUCTION &mdash; Cloud Metrics 2.1.3 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/jquery.hoverscroll.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-responsive.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '2.1.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/jquery.ba-hashchange.js"></script>
    <script type="text/javascript" src="_static/jquery.hoverscroll.js"></script>
    <script type="text/javascript" src="_static/bootstrap.js"></script>
    <script type="text/javascript" src="_static/bootstrap.scrollspy.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="Cloud Metrics 2.1.3 documentation" href="index.html" />
    <link rel="next" title="Modules" href="modules.html" />
    <link rel="prev" title="Welcome to Virtual Cluster documentation!" href="index.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  </head>
  <body>
  <div id="navbar" class="navbar navbar-inverse no-js">
    <div class="navbar-inner">
      <div class="container-fluid">
        <a class="brand" href="index.html">Cloud Metrics</a>
        <span class="navbar-text pull-left"></span>
        <ul class="nav">
          <li class="divider-vertical"></li>
          <li><b class="navbar-text">2.1.3</b></li>
          
            <li class="dropdown">
  <a href="index.html" class="dropdown-toggle" data-toggle="dropdown">Site <b class="caret"></b></a>
  <ul class="current dropdown-menu">
<li class="toctree-l1 current active"><a class="current reference internal" href="">INTRODUCTION</a></li>
<li class="toctree-l1"><a class="reference internal" href="#how-to-install">HOW TO INSTALL</a></li>
<li class="toctree-l1"><a class="reference internal" href="#how-to-run">HOW TO RUN</a></li>
<li class="toctree-l1"><a class="reference internal" href="#run-simple-mpi-programs-under-slurm">RUN SIMPLE MPI PROGRAMS UNDER SLURM</a></li>
<li class="toctree-l1"><a class="reference internal" href="#performance-test">PERFORMANCE TEST</a></li>
<li class="toctree-l1"><a class="reference internal" href="#for-developers-only">FOR DEVELOPERS ONLY</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Modules</a></li>
</ul>

</li>
            
          
          
            
  <li class="hidden-phone"><a href="index.html"
         title="previous chapter">&laquo; Welcome to Virtual Cluster documentation!</a></li>
  <li class="hidden-phone"><a href="modules.html"
         title="next chapter">Modules &raquo;</a></li>
          
          
            <li>
  <a href="_sources/intro.txt"
         rel="nofollow">Source</a></li>
          
        </ul>
        
          
<form class="navbar-search pull-right hidden-phone" style="margin-bottom:-3px;" action="search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        
      </div>
    </div>
  </div>

 <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
  <script src="http://code.jquery.com/ui/1.10.1/jquery-ui.js"></script>
  <script>
  $(function() {
    $( "#accordion" ).accordion();
  });
  </script>
  <div class="body container-fluid">
  <div class="row-fluid">
    <div class="content span9">
      
      
  <div class="section" id="introduction">
<h1>INTRODUCTION<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h1>
<div class="section" id="system-requirements">
<h2>System requirements<a class="headerlink" href="#system-requirements" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>euca2ools: verison 2.0.2</li>
<li>python: version 2.7</li>
<li>virtualenv (optional, if you do not have sudo rights)</li>
</ul>
</div>
<div class="section" id="code-repository">
<h2>Code Repository<a class="headerlink" href="#code-repository" title="Permalink to this headline">¶</a></h2>
<p>Our code and web page is maintained in github</p>
<ul class="simple">
<li>Source: <a class="reference external" href="https://github.com/futuregrid/virtual-cluster">https://github.com/futuregrid/virtual-cluster</a></li>
<li>Documentation: <a class="reference external" href="http://futuregrid.github.com/virtual-cluster">http://futuregrid.github.com/virtual-cluster</a></li>
</ul>
</div>
<div class="section" id="id1">
<h2>Introduction<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>This project contains a virtual cluster management
software utilizing OpenStack and Eucalyptus resources on FutureGrid.
The software contains several parts that could help users easily
manage their operations to virtual clusters on FutureGrid.</p>
<p>Managment operations include:</p>
<ul class="simple">
<li>Create virtual cluster(s)</li>
<li>Save currently running virtual cluster(s)</li>
<li>Restore saved virtual cluster(s)</li>
<li>Show status of virtual cluster(s)</li>
<li>List brief information of all created clusters</li>
<li>Terminate virtual cluster(s)</li>
<li>Run a simple MPI program</li>
</ul>
</div>
</div>
<div class="section" id="how-to-install">
<h1>HOW TO INSTALL<a class="headerlink" href="#how-to-install" title="Permalink to this headline">¶</a></h1>
<div class="section" id="first-setup">
<h2>First Setup<a class="headerlink" href="#first-setup" title="Permalink to this headline">¶</a></h2>
<p>We assume that yo do not have super user priviledges on the computer
where you like to install our tool.</p>
<ul>
<li><p class="first"><strong>Step 0: Prerequisites (not using india.futuregrid.org machines):</strong></p>
<p>In order to make the installation process work smoothly, please make
sure that the computer you like to install our tool has already
installed euca2ools (version 2.0.2) and Python (version 2.7). If you do
not have those tools or correct version installed. you may install
euca2ools (version 2.0.2) from</p>
<ul class="simple">
<li><a class="reference external" href="http://www.eucalyptus.com/download/euca2ools">http://www.eucalyptus.com/download/euca2ools</a></li>
</ul>
<p>and install python (version 2.7) from</p>
<ul class="simple">
<li><a class="reference external" href="http://python.org">http://python.org</a></li>
</ul>
<p>After you check all the tools with version are correctly installed,
you may proceed with following steps to start installation.</p>
</li>
<li><p class="first"><strong>Step 1: Prerequisites (using india.futuregrid.org machines):</strong></p>
<blockquote>
<div><p>india.futuregrid.org has installed every tools you may need to finish this
installation, so to activate euca2ools (version 2.0.2) after you login into
india futuregrid machines, just simply do:</p>
<div class="highlight-python"><pre>$ module load euca2ools</pre>
</div>
<p>To activate python 2.7, simply do:</p>
<div class="highlight-python"><pre>$ module load python</pre>
</div>
<p>Those commands will help you load tools with correct version you need
to finish installation. So now you may proceed with following
installation steps.</p>
</div></blockquote>
</li>
<li><p class="first"><strong>Step 2: Download virtualenv</strong></p>
<blockquote>
<div><p>Since you do not have super user priviledges, you need virtualenv in
order to finish the installtion. You may download virtualenv.py by
following command:</p>
<div class="highlight-python"><pre>$ wget https://raw.github.com/pypa/virtualenv/master/virtualenv.py</pre>
</div>
</div></blockquote>
</li>
<li><p class="first"><strong>Step 3: Install virtualenv</strong></p>
<blockquote>
<div><p>After you downloaded virtualenv, you can install it by following
command:</p>
<div class="highlight-python"><pre>$ python virtualenv.py --system-site-packages ENV</pre>
</div>
</div></blockquote>
</li>
<li><p class="first"><strong>Step 4: Activate virtualenv</strong></p>
<blockquote>
<div><p>After installation of virtualenv, you can activate virtualenv by
following command:</p>
<div class="highlight-python"><pre>$ source ENV/bin/activate</pre>
</div>
</div></blockquote>
</li>
<li><p class="first"><strong>Step 5: install the virtual cluster with pip</strong></p>
<blockquote>
<div><p>Once virtualenv is activated, you can use pip to install our tool by
following command:</p>
<div class="highlight-python"><pre>$ ENV/bin/pip install fgvirtualcluster</pre>
</div>
<p>If you already had our tool installed, and you want to upgrade to
newest version, you can do it by following command:</p>
<div class="highlight-python"><pre>$ ENV/bin/pip install --upgrade fgvirtualcluster</pre>
</div>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="repeated-use">
<h2>Repeated Use<a class="headerlink" href="#repeated-use" title="Permalink to this headline">¶</a></h2>
<p>We assume that you are using the same machine as the first time you ran our tool.</p>
<ul>
<li><p class="first"><strong>Step 1: Environment Setup (using india.futuregrid.org machines):</strong></p>
<blockquote>
<div><p>india.futuregrid.org has installed every tools you may need to finish this
installation, so to activate euca2ools (version 2.0.2) after you login into
india futuregrid machines, just simply do:</p>
<div class="highlight-python"><pre>$ module load euca2ools</pre>
</div>
<p>To activate python 2.7, simply do:</p>
<div class="highlight-python"><pre>$ module load python</pre>
</div>
<p>Those commands will help you load tools with correct version you need
to finish installation. So now you may proceed with following
installation steps.</p>
</div></blockquote>
</li>
<li><p class="first"><strong>Step 2: Activate virtualenv</strong></p>
<blockquote>
<div><p>You can activate virtualenv again by following command:</p>
<div class="highlight-python"><pre>$ source ENV/bin/activate</pre>
</div>
</div></blockquote>
</li>
</ul>
<p>Now you can use our tool to manage your virtual clusters.</p>
</div>
<div class="section" id="futuregrid-specific-installation">
<h2>FutureGrid Specific Installation<a class="headerlink" href="#futuregrid-specific-installation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="install-without-admin-rights-on-india-futuregrid">
<h3>Install without admin rights on india futuregrid<a class="headerlink" href="#install-without-admin-rights-on-india-futuregrid" title="Permalink to this headline">¶</a></h3>
<p>Go to the futuregrid portal</p>
<ul class="simple">
<li><a class="reference external" href="https://portal.futuregrid.org/">https://portal.futuregrid.org/</a></li>
</ul>
<p>If you do not have a futuregrid account, please apply for one at link:</p>
<ul class="simple">
<li><a class="reference external" href="https://portal.futuregrid.org/user/register">https://portal.futuregrid.org/user/register</a></li>
</ul>
<p>In order for you to get access to FutureGrid resources, you need to
apply for a portal account and create a Futuregrid project. This is in
detail explained at</p>
<ul class="simple">
<li><a class="reference external" href="https://portal.futuregrid.org/gettingstarted">https://portal.futuregrid.org/gettingstarted</a></li>
</ul>
<p>Do not forget to upload your public key.  (see also
<a class="reference external" href="https://portal.futuregrid.org/generating-ssh-keys-futuregrid-access">https://portal.futuregrid.org/generating-ssh-keys-futuregrid-access</a>)</p>
<p>Once you have a vaild portal account and a valid project, you can go
ahead and use FutureGrid.</p>
<p>Our virtual cluster is best executed on our machine called
india.futuregrid.org</p>
<p>Please log into this machine and follow the steps that we have outlined
in the previous section to install the software and then run it while
following the instaructions from the next section</p>
</div>
</div>
</div>
<div class="section" id="how-to-run">
<h1>HOW TO RUN<a class="headerlink" href="#how-to-run" title="Permalink to this headline">¶</a></h1>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>In order to use our tool, you need to obatin nova, eucalyptus
credentials and configuration files for FutureGrid system. These
should have been placed in your home directory on the INDIA
system. If you do not have a portal and HPC account please create one.
The credential zip file contains the rc file. Unzip this file in your
home directory. The novarc (OpenStack) and eucarc (Eucalyptus) file contains
the necessary environment variables.</p>
<p>Create your private key by (Recommended: Use your user name as your
private key name):</p>
<div class="highlight-python"><pre>$ euca-add-keypair youruserkey &gt; youruserkey.pem
$ chmod 0600 youruserkey.pem</pre>
</div>
<p>You can also use our tool to create a userkey for you, but you need
to specify the userkey name in configuration file which is listed
below. The key can be created if you use --create-key argument before
any subcommands when you first run our tool. For more help see also:</p>
<div class="highlight-python"><pre>$ fg-cluster --help</pre>
</div>
<p>However, this documentation is much more comprehensive than the help message.</p>
<p>NOTE: For more information about credentials, you can refer
to tutorial at:</p>
<div class="highlight-python"><pre>* https://portal.futuregrid.org/tutorials/openstack</pre>
</div>
<p>and:</p>
<div class="highlight-python"><pre>* https://portal.futuregrid.org/using-eucalyptus-futuregrid</pre>
</div>
</div>
<div class="section" id="create-configuration-file">
<h2>Create configuration file<a class="headerlink" href="#create-configuration-file" title="Permalink to this headline">¶</a></h2>
<p>You need to create a configuration file which needs to be passed to
this tool for locating necessary files in order to run. You can create
configuration file using text editor, or using an example we provide
to you</p>
<ul class="simple">
<li><a class="reference external" href="https://raw.github.com/futuregrid/virtual-cluster/master/etc/futuregrid.cfg">https://raw.github.com/futuregrid/virtual-cluster/master/etc/futuregrid.cfg</a></li>
</ul>
<p>It has the following format:</p>
<div class="highlight-python"><pre>[virtual-cluster]
# Backup file for saving and loading virtual cluster(s)
backup = ~/.futuregrid/virtual-cluster
# Slurm configuration input file
slurm = ~/.futuregrid/slurm.conf.in
# userkey pem file
userkey = ~/PUT-YOUR-USER-NAME-HERE.pem
# environment file
enrc = ~/novarc
# program interface
interface = euca2ools
# cloud to use
cloud = nova</pre>
</div>
<p>You will have to modify the &lt;PUT-YOUR-USER-NAME-HERE&gt; occurrence
within the file with the name that you use to associate your key. The
file is to be placed at ~/.futuregrid/futuregrid.cfg or concatenated
to an already existing futuregrid.cfg file. In order to use different
interface (euca2ools/boto) or cloud to run this tool, you can change
interface or cloud parameter in the configuration file to achieve that.</p>
<p>If you want to use a different configuration file instead of changing
one configuration file back and forth, you can use argument --file
before you specify each subcommand you would like to run.:</p>
<div class="highlight-python"><pre>$ fg-cluster --file &lt;configuration-file&gt; &lt;subcommands&gt;</pre>
</div>
<p>NOTE: Please make sure all the files are placed under the location as
you specified in configuration file. You can also find an example of
slurm.conf.in file which is used by configuring SLURM system from</p>
<ul class="simple">
<li><a class="reference external" href="https://raw.github.com/futuregrid/virtual-cluster/master/etc/slurm.conf.in">https://raw.github.com/futuregrid/virtual-cluster/master/etc/slurm.conf.in</a></li>
</ul>
<p>You can modify SLURM configuration parameters for your customized
SLURM. But please leave &quot;controlMachine&quot;, &quot;ControlAddr&quot; and &quot;COMPUTE NODES&quot;
untouched.</p>
<p>In the configuration file, you can choose different interface for this tool to use
(euca2ool or boto), just need to change interface parameter in the configuration file.
You also need to change enrc and cloud parameters in order to switch between different
clouds (nova/eucalyptus).</p>
<p>After you finished all steps above, you can use our tool to manage
your virtual clusters</p>
<ul class="simple">
<li><strong>OpenStack configuration example:</strong></li>
</ul>
<p>To correctly configure the tool to use OpenStack resources, you can refer to example:</p>
<div class="highlight-python"><pre>[virtual-cluster]
# Backup file for saving and loading virtual cluster(s)
backup = ~/.futuregrid/virtual-cluster
# Slurm configuration input file
slurm = ~/.futuregrid/slurm.conf.in
# userkey pem file
userkey = ~/PUT-YOUR-USER-NAME-HERE.pem
# environment file
enrc = ~/novarc
# program interface
interface = euca2ools
# cloud to use
cloud = nova</pre>
</div>
<ul class="simple">
<li><strong>Eucalyptus configuration example:</strong></li>
</ul>
<p>To correctly configure the tool to use Eucalyptus resources, you can refer to example:</p>
<div class="highlight-python"><pre>[virtual-cluster]
# Backup file for saving and loading virtual cluster(s)
backup = ~/.futuregrid/virtual-cluster
# Slurm configuration input file
slurm = ~/.futuregrid/slurm.conf.in
# userkey pem file
userkey = ~/PUT-YOUR-USER-NAME-HERE.pem
# environment file
enrc = ~/eucarc
# program interface
interface = euca2ools
# cloud to use
cloud = eucalyptus</pre>
</div>
</div>
<div class="section" id="create-a-virtual-cluster">
<h2>Create a virtual cluster<a class="headerlink" href="#create-a-virtual-cluster" title="Permalink to this headline">¶</a></h2>
<p>Run following command will create a virtual cluster of given
parameters (command example is given below):</p>
<div class="highlight-python"><pre>$ fg-cluster run -n &lt;number-of-computation-nodes&gt; -t &lt;instance-type&gt; -i &lt;image-id&gt; -a &lt;cluster-name&gt;</pre>
</div>
<p>Parameters:</p>
<blockquote>
<div><table class="docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">-n</span></kbd></td>
<td>Number of computation nodes.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-t</span></kbd></td>
<td>Instance type.
Instance type includes: m1.tiny, m1.small and m1.large.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-i</span></kbd></td>
<td>Image id. You can obtain image with a commandline tool such as <code>euca-describe-images</code>.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-a</span></kbd></td>
<td>Cluster name.
The virtual cluster name which uniquely identifies your cluster.</td></tr>
</tbody>
</table>
</div></blockquote>
<p>Please note that the number of computation nodes does not include the control node, so the actual number for virtual cluster.
nodes is the number of computations node plus one control node.</p>
<p>For example:</p>
<div class="highlight-python"><pre>$ fg-cluster run -n 2 -t m1.small -i ami-0000001d -a mycluster1</pre>
</div>
<p>Virtual cluster info will be saved in backup file specified in
futuregrid configuration file. Note: Cluster name should be different
as other virtual clusters which is running if you want to run multiple
virtual clusters.</p>
</div>
<div class="section" id="save-a-virtual-cluster">
<h2>Save a virtual cluster<a class="headerlink" href="#save-a-virtual-cluster" title="Permalink to this headline">¶</a></h2>
<p>Run following command will save a currently running virtual cluster into one
control image and compute image for later resotre. (Installed softwares and
unfinished jobs will also be saved):</p>
<div class="highlight-python"><pre>$ fg-cluster checkpoint -c &lt;control-node-bucket&gt; -t &lt;control-node-name&gt; -m &lt;compute-bucket&gt; -e  &lt;compute-name&gt; -a &lt;cluster-name&gt; -s &lt;image-size&gt;</pre>
</div>
<p>Parameters:</p>
<blockquote>
<div><table class="docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">-c</span></kbd></td>
<td>Control node bucket name. Bucket name which you can identify control image</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-t</span></kbd></td>
<td>Control node image name. Image name which you can use to identify your control image</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-m</span></kbd></td>
<td>Compute node bucket name. Bucket name which you can identify your compute image</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-e</span></kbd></td>
<td>Compute node image name. Image name which you can use to identify your compute image</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-a</span></kbd></td>
<td>Virtual cluster name</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-s</span></kbd></td>
<td>Image size, in MB</td></tr>
</tbody>
</table>
</div></blockquote>
<p>For example:</p>
<div class="highlight-python"><pre>$ fg-cluster checkpoint -c myname -t c1.img -m myname -e c2.img -a mycluster1 -s 1024</pre>
</div>
<p>If you successfully upload your control image and compute image, you
can find them by command:</p>
<div class="highlight-python"><pre>$ euca-describe-images</pre>
</div>
<p>Note: Cluster name should be a name of cluster which is
currently running. Generated image ids (including one control
node image id and one compute image id) will be registered which
are used for later restore. Please CHECK avaliable space on instances
before you save cluster, image size should be smaller than the avaliable
space on each instance of the virtual cluster you want to save.</p>
</div>
<div class="section" id="restore-a-virtual-cluster">
<h2>Restore a virtual cluster<a class="headerlink" href="#restore-a-virtual-cluster" title="Permalink to this headline">¶</a></h2>
<p>Run following command will restore a virtual cluster state including
installed softwares, unfinished jobs which was saved before, so that
you can continue your work from that saved point:</p>
<div class="highlight-python"><pre>$ fg-cluster restore -a &lt;cluster-name&gt;</pre>
</div>
<p>Parameters:</p>
<blockquote>
<div><table class="docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">-a</span></kbd></td>
<td>Cluster name. The virtual cluster name which uniquely identifies your cluster.</td></tr>
</tbody>
</table>
</div></blockquote>
<p>For example:</p>
<div class="highlight-python"><pre>$ fg-cluster restore -a mycluster2</pre>
</div>
<p>Note: Cluster name should be the name of cluster which had been saved
before.  You can check the images you saved, the images you saved will
have the bucket name and image name you specified from checkpoint command,
and which can be shown by following command:</p>
<div class="highlight-python"><pre>$ euca-describe-images</pre>
</div>
</div>
<div class="section" id="shutdown-a-virtual-cluster">
<h2>Shutdown a virtual cluster<a class="headerlink" href="#shutdown-a-virtual-cluster" title="Permalink to this headline">¶</a></h2>
<p>Run following command will terminate a virtual cluster:</p>
<div class="highlight-python"><pre>$ fg-cluster terminate -a &lt;cluster-name&gt;</pre>
</div>
<p>Parameters:</p>
<blockquote>
<div><table class="docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">-a</span></kbd></td>
<td>Virtual cluster name</td></tr>
</tbody>
</table>
</div></blockquote>
<p>For example:</p>
<div class="highlight-python"><pre>$ fg-cluster terminate -a mycluster2</pre>
</div>
<p>Note: Cluster name should be a name of cluster which is currently
running.</p>
</div>
<div class="section" id="show-status-of-virtual-cluster-s">
<h2>Show status of virtual cluster(s)<a class="headerlink" href="#show-status-of-virtual-cluster-s" title="Permalink to this headline">¶</a></h2>
<p>Run following command will show status of currently running
virtual cluster(s) including cluster size, image id, instance id, IP addresses:</p>
<div class="highlight-python"><pre>$ fg-cluster status -a &lt;cluster-name&gt;</pre>
</div>
<p>Parameters:</p>
<blockquote>
<div><table class="docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">-a</span></kbd></td>
<td>Virtual cluster name</td></tr>
</tbody>
</table>
</div></blockquote>
<p>For example:</p>
<p>Show status of one specific cluster given cluster name:</p>
<div class="highlight-python"><pre>fg-cluster status -a mycluster1</pre>
</div>
<p>Show status of all currently running clusters:</p>
<div class="highlight-python"><pre>fg-cluster status</pre>
</div>
<p>Note: If argument -a is specified, then the cluster you want to show status should be
a cluster that is currently running. If argument -a is not specified, the tool will
show the status of all virtual clusters.</p>
</div>
<div class="section" id="list-the-virtual-clusters">
<h2>List the virtual clusters<a class="headerlink" href="#list-the-virtual-clusters" title="Permalink to this headline">¶</a></h2>
<p>Run following command will give you a list of virtual clusters and their status:</p>
<div class="highlight-python"><pre>$ fg-cluster list</pre>
</div>
<p>For example:</p>
<div class="highlight-python"><pre>$ fg-cluster list</pre>
</div>
</div>
</div>
<div class="section" id="run-simple-mpi-programs-under-slurm">
<h1>RUN SIMPLE MPI PROGRAMS UNDER SLURM<a class="headerlink" href="#run-simple-mpi-programs-under-slurm" title="Permalink to this headline">¶</a></h1>
<p>A simple MPI version of helloworld can be found at:</p>
<ul class="simple">
<li><a class="reference external" href="https://raw.github.com/futuregrid/virtual-cluster/master/etc/helloworld.c">https://raw.github.com/futuregrid/virtual-cluster/master/etc/helloworld.c</a></li>
</ul>
<p>You may use this for test purpose.</p>
<p>We assume that you are using helloworld.c from above link. So in order to run this MPI program
on the cluster you created using SLURM system, you can conduct the following steps.</p>
<ul>
<li><p class="first"><strong>Step 1: Copy helloworld.c to HOME directory on each node in virtual cluster</strong></p>
<blockquote>
<div><div class="highlight-python"><pre>$ scp -i &lt;your-userkey-pem-file&gt; helloworld.c ubuntu@&lt;instance-ip&gt;:~/</pre>
</div>
</div></blockquote>
</li>
<li><p class="first"><strong>Step 2: Login to instances, complie helloworld.c on each node, run</strong></p>
<blockquote>
<div><div class="highlight-python"><pre>$ ssh -i &lt;your-userkey-pem-file&gt; ubuntu@&lt;instance-ip&gt;
$ mpicc hellowrld.c -o helloworld</pre>
</div>
</div></blockquote>
</li>
<li><p class="first"><strong>Step 3: run MPI program, you need to login into control node</strong></p>
<blockquote>
<div><p>Option 1: Using salloc command:</p>
<div class="highlight-python"><pre>$ salloc -N 2 mpirun helloworld</pre>
</div>
<p>where -N is the number of computation nodes you want to run with. And
should not be larger than the actual number of computation nodes</p>
<p>Option 2: Using sbatch command by submitting a job script:</p>
<div class="highlight-python"><pre>$ sbatch helloworld.sh</pre>
</div>
<p>You can find example helloworld.sh at</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/futuregrid/virtual-cluster/blob/master/etc/helloworld.sh">https://github.com/futuregrid/virtual-cluster/blob/master/etc/helloworld.sh</a></li>
</ul>
<p>Execution result:</p>
<div class="highlight-python"><pre>Running program helloworld
salloc: Granted job allocation 2
Hello world from processor i-000023c8, rank 0 out of 2 processors
Hello world from processor i-000023c9, rank 1 out of 2 processors
salloc: Relinquishing job allocation 2</pre>
</div>
</div></blockquote>
</li>
</ul>
<div class="section" id="using-fg-cluster-tool">
<h2>Using fg-cluster tool<a class="headerlink" href="#using-fg-cluster-tool" title="Permalink to this headline">¶</a></h2>
<p>A much simpler way to run a MPI program is to use our tool</p>
<p>You can choose different ways to run your MPI program, one way is to
use salloc command in SLURM and another way is to use sbatch command.
And you can also use our tool to achieve this.</p>
<p>If you want to directly run MPI program using salloc, you can simply run command:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># fg-cluster mpirun -p &lt;program-source-file&gt; -n &lt;compute-nodes-to-use&gt; -a &lt;cluster-name&gt;</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># fg-cluster mpirun -p helloworld.c -n 2 -a mycluster1</span>
</pre></div>
</div>
<p>If you want to submit a job script to the SLURM, you can simply run command:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># fg-cluster mpirun -p &lt;program-source-file&gt; -n &lt;compute-nodes-to-use&gt; -a &lt;cluster-name&gt; -s &lt;script-name&gt;</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># fg-cluster mpirun -p helloworld.c -n 2 -a mycluster1 -s helloworld.sh</span>
</pre></div>
</div>
<p>Parameters</p>
<blockquote>
<div><table class="docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">-p</span></kbd></td>
<td>Program source code file</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-n</span></kbd></td>
<td>Number of computaion nodes you want to run with.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-a</span></kbd></td>
<td>Name of virtual cluster you want to run program on</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-s</span></kbd></td>
<td>Job script you would like to submit to SLURM</td></tr>
</tbody>
</table>
</div></blockquote>
<p>Make sure that the number you input is no larger than the acutal number of computaion node you created.
The virtual cluster name should be a name of cluster which is currently running.</p>
</div>
</div>
<div class="section" id="performance-test">
<h1>PERFORMANCE TEST<a class="headerlink" href="#performance-test" title="Permalink to this headline">¶</a></h1>
<p>You can use our tool to run performance test on OpenStack and Eucalyptus.</p>
<div class="section" id="id2">
<h2>Prerequisites<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>In order to use our tool to run performance test on Openstack and Eucalyptus. You must have
our tool correctly installed. You can refer to the tutorial about how to run in the pervious
sections. Once you can successfully run our tool, you can proceed with the following steps.</p>
</div>
<div class="section" id="id3">
<h2>How to run<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>Followings are steps you need to follow in order to successfully run performance test using our tool</p>
<ul>
<li><p class="first"><strong>Step 1: Download our peroformance test tool</strong></p>
<blockquote>
<div><p>You can download the performan test tool from</p>
<ul class="simple">
<li><a class="reference external" href="https://raw.github.com/futuregrid/virtual-cluster/master/performance/Performance_Testall.py">https://raw.github.com/futuregrid/virtual-cluster/master/performance/Performance_Testall.py</a></li>
</ul>
<p>Performance_Testall.py is the test script that you can use to run the performance test.</p>
<ul class="simple">
<li><a class="reference external" href="https://raw.github.com/futuregrid/virtual-cluster/master/performance/Performance_Statistic.py">https://raw.github.com/futuregrid/virtual-cluster/master/performance/Performance_Statistic.py</a></li>
</ul>
<p>Performance_Statistic is the data process program which could prodeuce excel sheets on data you collected</p>
<ul class="simple">
<li><a class="reference external" href="https://raw.github.com/futuregrid/virtual-cluster/master/performance/Performance_Plot.py">https://raw.github.com/futuregrid/virtual-cluster/master/performance/Performance_Plot.py</a></li>
</ul>
<p>Performance_Plot is the graph produce program which could prodeuce graphs for each cloud you tested</p>
<ul class="simple">
<li><a class="reference external" href="https://raw.github.com/futuregrid/virtual-cluster/master/performance/Performance_Comp.py">https://raw.github.com/futuregrid/virtual-cluster/master/performance/Performance_Comp.py</a></li>
</ul>
<p>Performance_Comp is the comparison graph produce program which could produce comparison graphs
between clouds you tested on</p>
<p>Also, you can download our source code from github, and then you can find performance tool under
virtual-cluster/performance folder.</p>
<p>NOTE: When you switch performance test between OpenStack and Eucalyptus, please make sure that you have
futuregrid.cfg file correctly configuared. See below section about switching between clouds.</p>
</div></blockquote>
</li>
<li><p class="first"><strong>Step 2: Run performance test script</strong></p>
<blockquote>
<div><p>Beaucase each test involves running a MPI program, so please download our sample MPI helloworld from</p>
<ul class="simple">
<li><a class="reference external" href="https://raw.github.com/futuregrid/virtual-cluster/master/etc/helloworld.c">https://raw.github.com/futuregrid/virtual-cluster/master/etc/helloworld.c</a></li>
</ul>
<p>and put it where you would like you run the test script.</p>
<p>If you have done all the steps above, then you can run the test scripte by:</p>
<div class="highlight-python"><pre>$ python Performance_Testall.py -o &lt;output-file&gt; -i &lt;image-id&gt;</pre>
</div>
<p>This will run tests which involve creating different virtual clusters with various parameters,
running MPI program and terminating virtual clusters, then produces output file which contains
all the performance test result data you collected.</p>
<p>When you finish performance test, you will get result like following:</p>
<div class="highlight-python"><pre>Test Name               Total Time      Installation    Configuration   Execution       Termination     IP association  IP association fail     IP change       Restart
euca-m1.small-1         115.702837944   96.9913449287   6.05437302589   0.58861207962   0.159124135971  N/A             N/A                     N/A             N/A
euca-m1.small-1         111.77609396    92.9926450253   6.03100919724   0.55158996582   0.157529830933  N/A             N/A                     N/A             N/A
euca-m1.small-1         110.741933107   92.9937160015   5.04305911064   0.598108053207  0.16206908226   N/A             N/A                     N/A             N/A
nova-m1.small-1         151.426457167   134.004024982   2.22711896896   0.196369886398  1.20041799545   4.12035417557   0                       0               0
nova-m1.small-1         163.470904827   146.006072998   2.24714803696   0.179543972015  1.0476629734    4.10231184959   0                       0               0
nova-m1.small-1         153.810782194   136.004303932   2.69106817245   0.219621181488  1.00952887535   4.1146697998    0                       0               0</pre>
</div>
<p>NOTE: The script will create clusters with size 1, 2, 4, 8, 16, 24, 32; with instance type small,
medium, large</p>
</div></blockquote>
</li>
<li><p class="first"><strong>Step 3: Process performance test data</strong></p>
<blockquote>
<div><p>Once you have done the performance test and outpus the raw data file. You can create excel sheets
or graphs using our tool.</p>
<p>However, before you can proceed, you need to install numpy and matplotlib which are required by the tool:</p>
<div class="highlight-python"><pre>$ pip install numpy
$ pip install matplotlib</pre>
</div>
<p>Then, you can creats excel sheets by the following command:</p>
<div class="highlight-python"><pre>$ python Performance_Statistic.py -f &lt;your-performance-test-result-file&gt;</pre>
</div>
<p>This will create two excels for you which you can view via excel. One is for OpenStack data,
and the other one is for Eucalyptus data.</p>
<p>The file has the following format (in plain text):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">name</span><span class="p">,</span><span class="n">t_total_avg</span><span class="p">,</span><span class="n">t_total_min</span><span class="p">,</span><span class="n">t_total_max</span><span class="p">,</span><span class="n">t_total_stdev</span><span class="p">,</span><span class="n">t_setup_install_avg</span><span class="p">,</span><span class="n">t_setup_install_min</span><span class="p">,</span><span class="n">t_setup_install_max</span><span class="p">,</span><span class="n">t_setup_install_stdev</span><span class="p">,</span><span class="n">t_setup_configure_avg</span><span class="p">,</span><span class="n">t_setup_configure_min</span><span class="p">,</span><span class="n">t_setup_configure_max</span><span class="p">,</span><span class="n">t_setup_configure_stdev</span><span class="p">,</span><span class="n">t_execute_avg</span><span class="p">,</span><span class="n">t_execute_min</span><span class="p">,</span><span class="n">t_execute_max</span><span class="p">,</span><span class="n">t_execute_stdev</span><span class="p">,</span><span class="n">t_shutdown_avg</span><span class="p">,</span><span class="n">t_shutdown_min</span><span class="p">,</span><span class="n">t_shutdown_max</span><span class="p">,</span><span class="n">t_shutdown_stdev</span>
<span class="n">euca</span><span class="o">-</span><span class="n">m1</span><span class="o">.</span><span class="n">small</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mf">139.072920442</span><span class="p">,</span><span class="mf">113.236577034</span><span class="p">,</span><span class="mf">164.909263849</span><span class="p">,</span><span class="mf">25.8363434075</span><span class="p">,</span><span class="mf">114.992971659</span><span class="p">,</span><span class="mf">85.9957351685</span><span class="p">,</span><span class="mf">143.990208149</span><span class="p">,</span><span class="mf">28.9972364903</span><span class="p">,</span><span class="mf">6.78620207309</span><span class="p">,</span><span class="mf">6.69066214561</span><span class="p">,</span><span class="mf">6.88174200058</span><span class="p">,</span><span class="mf">0.095539927485</span><span class="p">,</span><span class="mf">0.642117619514</span><span class="p">,</span><span class="mf">0.613047122955</span><span class="p">,</span><span class="mf">0.671188116074</span><span class="p">,</span><span class="mf">0.0290704965595</span><span class="p">,</span><span class="mf">0.256532430649</span><span class="p">,</span><span class="mf">0.254338026047</span><span class="p">,</span><span class="mf">0.258726835251</span><span class="p">,</span><span class="mf">0.002194404602</span>
<span class="n">euca</span><span class="o">-</span><span class="n">m1</span><span class="o">.</span><span class="n">small</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mf">112.740288337</span><span class="p">,</span><span class="mf">110.741933107</span><span class="p">,</span><span class="mf">115.702837944</span><span class="p">,</span><span class="mf">2.13696003674</span><span class="p">,</span><span class="mf">94.3259019852</span><span class="p">,</span><span class="mf">92.9926450253</span><span class="p">,</span><span class="mf">96.9913449287</span><span class="p">,</span><span class="mf">1.88475283095</span><span class="p">,</span><span class="mf">5.70948044459</span><span class="p">,</span><span class="mf">5.04305911064</span><span class="p">,</span><span class="mf">6.05437302589</span><span class="p">,</span><span class="mf">0.471327566829</span><span class="p">,</span><span class="mf">0.579436699549</span><span class="p">,</span><span class="mf">0.55158996582</span><span class="p">,</span><span class="mf">0.598108053207</span><span class="p">,</span><span class="mf">0.0200686125267</span><span class="p">,</span><span class="mf">0.159574349721</span><span class="p">,</span><span class="mf">0.157529830933</span><span class="p">,</span><span class="mf">0.16206908226</span><span class="p">,</span><span class="mf">0.00188028720646</span>
</pre></div>
</div>
<p>You can also create graphs for each cloud by the following command:</p>
<div class="highlight-python"><pre>$ python Performance_Plot.py -f &lt;your-performance-test-result-file&gt;</pre>
</div>
<p>and create comparison graphs by:</p>
<div class="highlight-python"><pre>$ python Performance_Comp.py -ie &lt;your-performance-test-result-about-eucalyptus-on-india&gt; -se &lt;your-performance-test-result-about-eucalyptus-on-sierra&gt; -in &lt;your-performance-test-result-about-openstack-on-india&gt;</pre>
</div>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="switch-between-openstack-and-eucalyptus">
<h2>Switch between OpenStack and Eucalyptus<a class="headerlink" href="#switch-between-openstack-and-eucalyptus" title="Permalink to this headline">¶</a></h2>
<p>If you want to use our tool to do performance test on OpenStack and Eucalyptus, you can switch between
clouds just by changing futuregrid.cfg configuration file. You can refer to the configuration file section
to change your configuration file accodringly.</p>
<p>Before you run a test script, you need to choose to a proper image (ubuntu) before each run (You can use euca2ools
to test the image before you run our script). To avoid output files overwritten, please use different file names,
and later you can use these performance output files to produce nice graphs.</p>
</div>
</div>
<div class="section" id="for-developers-only">
<h1>FOR DEVELOPERS ONLY<a class="headerlink" href="#for-developers-only" title="Permalink to this headline">¶</a></h1>
<div class="section" id="generating-the-distribution">
<h2>Generating the Distribution<a class="headerlink" href="#generating-the-distribution" title="Permalink to this headline">¶</a></h2>
<p>Assume that you have git correctly installed, configured on your
computer. And you also added your ssh public key on github. So you
can proceed with step 1.</p>
<p>If you use machines on indiana futuregrid, you can load git by</p>
<blockquote>
<div><div class="highlight-python"><pre>module load git</pre>
</div>
</div></blockquote>
<p>And added ssh public key on github.</p>
<ul>
<li><p class="first"><strong>Step 1: You can pull source code from github by</strong></p>
<blockquote>
<div><div class="highlight-python"><pre>git clone git@github.com:futuregrid/virtual-cluster.git</pre>
</div>
</div></blockquote>
</li>
<li><p class="first"><strong>Step 2: Create tar file for installation</strong></p>
<blockquote>
<div><div class="highlight-python"><pre>make pip</pre>
</div>
<p>This creates the tar file that you can install via pip in ./dist</p>
</div></blockquote>
</li>
<li><p class="first"><strong>Step 3: Install</strong></p>
<blockquote>
<div><div class="highlight-python"><pre>sudo pip install --upgrade dist/*.tar.gz</pre>
</div>
<p>This wil install the files by default into /usr/local/bin/fg-cluster</p>
</div></blockquote>
</li>
</ul>
</div>
</div>


    </div>
      <div class="page-toc page-sidebar span3 visible-desktop">
        <div class="well"><ul class="nav nav-list">
<li class="nav-header"><a class="reference internal" href="#">INTRODUCTION</a></li>
<li><a class="reference internal" href="#system-requirements">System requirements</a></li>
<li><a class="reference internal" href="#code-repository">Code Repository</a></li>
<li><a class="reference internal" href="#id1">Introduction</a></li>
</ul>
</div>
      </div>
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
    </p>
    <p>
        &copy; Created as part of FutureGrid 2012, Gregor von Laszewski, Fugang Wang, Hyungro Lee, Javier Diaz<br/>
    </p>
  </div>
</footer>
  </body>
</html>